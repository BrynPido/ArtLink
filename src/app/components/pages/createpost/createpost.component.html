<div class="max-w-3xl mx-auto font-sans p-4">
  <h1 class="text-2xl font-bold text-gray-800 mb-6">Create New Post</h1>

  <!-- Form -->
  <form [formGroup]="postForm" (ngSubmit)="submitPost()" class="space-y-6">
    <!-- Post Title -->
    <div class="space-y-2">
      <label for="postTitle" class="block text-sm font-medium text-gray-700">Title</label>
      <input type="text" id="postTitle" formControlName="title"
        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        placeholder="Enter a title for your post" aria-describedby="titleError">
      <div *ngIf="isInvalid('title')" id="titleError" class="text-red-500 text-sm mt-1">
        <span *ngIf="postForm.get('title')?.errors?.['required']">Title is required.</span>
        <span *ngIf="postForm.get('title')?.errors?.['maxlength']">Title must be less than 100 characters.</span>
      </div>
    </div>

    <!-- Post Content -->
    <div class="space-y-2">
      <label for="postContent" class="block text-sm font-medium text-gray-700">Content</label>
      <textarea id="postContent" formControlName="content" rows="4"
        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        placeholder="What's on your mind?" aria-describedby="contentError"></textarea>
      <div *ngIf="isInvalid('content')" id="contentError" class="text-red-500 text-sm mt-1">
        <span *ngIf="postForm.get('content')?.errors?.['maxlength']">Content must be less than 2000 characters.</span>
      </div>
      <div class="text-sm text-gray-500">
        {{ postForm.get('content')?.value?.length || 0 }}/2000 characters
      </div>
    </div>

    <!-- Media Upload Section -->
    <div class="space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-medium text-gray-700">Media</h2>
        <span class="text-sm text-gray-500">{{ mediaItems.length }} files added</span>
      </div>

      <div
        class="text-center p-4 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer">
        <label for="mediaUpload" class="block cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none"
            viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <p class="mt-1 text-sm text-gray-600">Click to add images or videos</p>
          <p class="text-xs text-gray-500 mt-1">JPG, PNG, GIF, WebP, MP4, WebM up to 10MB</p>
        </label>
        <input type="file" id="mediaUpload" (change)="onFileSelected($event)"
          accept="image/jpeg,image/png,image/gif,image/webp,video/mp4,video/webm" multiple class="sr-only"
          aria-label="Upload media">
      </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="bg-red-100 text-red-700 p-3 rounded-md flex justify-between items-center" role="alert">
      {{ error }}
      <button type="button" (click)="error = null"
        class="bg-transparent border-none text-xl cursor-pointer text-red-700 hover:text-red-800"
        aria-label="Dismiss error">
        ×
      </button>
    </div>

    <!-- Loading Indicator -->
    <div *ngIf="isLoading" class="flex items-center justify-center p-4 text-indigo-600" aria-live="polite">
      <div class="w-6 h-6 border-2 border-indigo-300 border-t-indigo-600 rounded-full animate-spin mr-2"></div>
      <span>Loading media...</span>
    </div>

    <!-- Media Gallery -->
    <div *ngIf="mediaItems.length > 0" class="border border-gray-200 rounded-lg overflow-hidden">
      <div class="flex justify-center items-center p-3 bg-gray-50 border-b border-gray-200">
        <button type="button" (click)="previousMedia()"
          class="bg-indigo-600 text-white border-none rounded-md py-2 px-4 text-base cursor-pointer transition-colors hover:bg-indigo-700 disabled:bg-indigo-200 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-2"
          [disabled]="currentMediaIndex <= 0" aria-label="Previous media">
          ←
        </button>

        <div class="mx-4 font-medium text-gray-600">
          {{ currentMediaIndex + 1 }} / {{ mediaItems.length }}
        </div>

        <button type="button" (click)="nextMedia()"
          class="bg-indigo-600 text-white border-none rounded-md py-2 px-4 text-base cursor-pointer transition-colors hover:bg-indigo-700 disabled:bg-indigo-200 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-2"
          [disabled]="currentMediaIndex >= mediaItems.length - 1" aria-label="Next media">
          →
        </button>
      </div>

      <div class="relative h-96 bg-gray-100 flex justify-center items-center">
        <div *ngFor="let item of mediaItems; let i = index" [class.opacity-100]="currentMediaIndex === i"
          [class.opacity-0]="currentMediaIndex !== i" [class.z-10]="currentMediaIndex === i"
          class="absolute w-full h-full flex flex-col justify-center items-center transition-opacity duration-300">
          <!-- Image Preview -->
          <img *ngIf="item.mediaType === 'image'" [src]="item.url" [style.filter]="item.filter"
            [alt]="'Uploaded image: ' + item.name" [attr.aria-label]="getAriaLabel(i)"
            class="max-w-[90%] max-h-[80%] object-contain rounded shadow-md">

          <!-- Video Preview -->
          <video *ngIf="item.mediaType === 'video'" [src]="item.url" [style.filter]="item.filter" controls
            class="max-w-[90%] max-h-[80%] rounded shadow-md">
            Your browser does not support the video tag.
          </video>

          <div class="mt-3 text-center text-gray-600">
            <p class="font-medium my-1 break-all max-w-[90%]">{{ item.name }}</p>
            <p class="text-sm text-gray-500 m-0">{{ item.size }} • {{ item.mediaType }}</p>
          </div>
        </div>
      </div>

      <!-- Media Controls -->
      <div *ngIf="mediaItems.length > 0 && currentMediaIndex >= 0"
        class="p-4 bg-gray-50 border-t border-gray-200 flex flex-wrap gap-4 justify-between items-center">
        <div class="flex items-center gap-2">
          <label for="filterSelect" class="text-gray-700">Apply filter:</label>
          <select id="filterSelect" (change)="applyFilter($event)"
            class="p-2 border border-gray-300 rounded-md bg-white text-gray-800 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400"
            [value]="mediaItems[currentMediaIndex]?.filter">
            <option *ngFor="let filter of availableFilters" [value]="filter.value">
              {{ filter.label }}
            </option>
          </select>
        </div>

        <div class="flex gap-2">
          <button type="button" (click)="removeCurrentMedia()"
            class="py-2 px-4 bg-red-500 text-white border-none rounded-md text-sm cursor-pointer transition-colors hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2"
            aria-label="Remove current media">
            Remove
          </button>

          <button type="button" (click)="removeAllMedia()"
            class="py-2 px-4 bg-gray-500 text-white border-none rounded-md text-sm cursor-pointer transition-colors hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2"
            aria-label="Remove all media">
            Clear All
          </button>
        </div>
      </div>
    </div>

    <!-- Publishing Options -->
    <div class="flex items-center">
      <input type="checkbox" id="publishPost" formControlName="published"
        class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
      <label for="publishPost" class="ml-2 block text-sm text-gray-900">
        Publish immediately (uncheck to save as draft)
      </label>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-end">
      <button type="submit"
        class="px-6 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400 disabled:cursor-not-allowed"
        [disabled]="submitting">
        <div *ngIf="submitting"
          class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>
        {{ submitting ? 'Creating Post...' : 'Create Post' }}
      </button>
    </div>
  </form>
</div>